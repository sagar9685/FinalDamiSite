<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Build Your Resume</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      /* General form container styling */
      .form-container {
        max-width: 600px;
        margin: 50px auto;
        background: #f7f7f7;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        font-family: "Arial", sans-serif;
      }

      /* Form header */
      .contact_form h2 {
        text-align: center;
        margin-bottom: 20px;
        color: #333;
      }

      /* Form group styling */
      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        color: #555;
        font-weight: bold;
      }

      /* Input and textarea styling */
      .form-control {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 16px;
        transition: border-color 0.3s ease-in-out;
      }

      .form-control:focus {
        border-color: #007bff;
        outline: none;
        box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
      }

      /* Custom file input styling */
      .custom-file-input {
        display: none;
      }

      .custom-file-label {
        display: block;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        background: #fff;
        cursor: pointer;
        text-align: center;
      }

      .custom-file-label:hover {
        background: #f1f1f1;
      }

      /* Error messages */
      .alert-danger {
        color: #d9534f;
        background-color: #f8d7da;
        border-color: #f5c6cb;
        padding: 10px;
        border-radius: 4px;
        margin-top: 5px;
      }

      /* Button styling */
      .button-contactForm {
        width: 100%;
        padding: 12px;
        background: #007bff;
        border: none;
        border-radius: 4px;
        color: #fff;
        font-size: 16px;
        cursor: pointer;
        transition: background 0.3s ease-in-out;
      }

      .button-contactForm:hover {
        background: #0056b3;
      }
    </style>
  </head>

  <body>
    <section class="form-container">
      <div class="contact_form">
        <h2>Build Your Resume</h2>

        <!-- Success/Error Message -->
        <div class="msg-box" id="msgBox"></div>

        <!-- Personal Information -->
        <div class="form-group">
          <label for="fullName">Full Name üßë‚Äçüéì</label>
          <input
            type="text"
            id="fullName"
            class="form-control"
            placeholder="Enter Full Name"
            required
          />
          <div
            class="alert alert-danger"
            id="nameError"
            style="display: none"
          ></div>
        </div>

        <div class="form-group mb-3">
          <label for="username">Username</label>
          <input type="text" id="username" class="form-control" readonly />
        </div>

        <div class="form-group">
          <label for="address">Address üìç</label>
          <textarea
            id="address"
            class="form-control"
            placeholder="Enter Address"
            required
          ></textarea>
        </div>

        <div class="form-group">
          <label for="mobile">Mobile No üìû</label>
          <input
            type="tel"
            id="mobile"
            class="form-control"
            placeholder="Enter Mobile No"
            required
          />
          <div
            class="alert alert-danger"
            id="mobileError"
            style="display: none"
          ></div>
        </div>

        <div class="form-group mb-3">
          <label for="email">Email</label>
          <input type="email" id="email" class="form-control" readonly />
        </div>

        <div class="form-group">
          <label for="sex">Sex</label>
          <select id="sex" class="form-control" required>
            <option value="">Select Sex</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
            <option value="Other">Other</option>
            <option value="Prefer not to say">Prefer not to say</option>
          </select>
          <div
            class="alert alert-danger"
            id="sexError"
            style="display: none"
          ></div>
        </div>

        <div class="form-group">
          <label for="race">Race</label>
          <select id="race" class="form-control" required>
            <option value="">Select Race</option>
            <option value="American Indian or Alaska Native">
              American Indian or Alaska Native
            </option>
            <option value="Asian">Asian</option>
            <option value="Black or African American">
              Black or African American
            </option>
            <option value="Native Hawaiian or Other Pacific Islander">
              Native Hawaiian or Other Pacific Islander
            </option>
            <option value="White">White</option>
            <option value="Two or More Races">Two or More Races</option>
            <option value="Prefer not to say">Prefer not to say</option>
          </select>
          <div
            class="alert alert-danger"
            id="raceError"
            style="display: none"
          ></div>
        </div>

        <div class="form-group">
          <label for="ethnicity">Ethnicity</label>
          <select id="ethnicity" class="form-control" required>
            <option value="">Select Ethnicity</option>
            <option value="Hispanic or Latino">Hispanic or Latino</option>
            <option value="Not Hispanic or Latino">
              Not Hispanic or Latino
            </option>
            <option value="Prefer not to say">Prefer not to say</option>
          </select>
          <div
            class="alert alert-danger"
            id="ethnicityError"
            style="display: none"
          ></div>
        </div>
        <div class="form-group">
          <label for="country">Country üåç</label>
          <select id="country" class="form-control" required>
            <option value="">Select Country</option>
            <option value="USA">United States</option>

            <!-- Add more countries as needed -->
          </select>
          <div
            class="alert alert-danger"
            id="countryError"
            style="display: none"
          ></div>
        </div>

        <div class="form-group">
          <label for="state">State</label>
          <select id="state" class="form-control" required>
            <option value="">Select State</option>
            <option value="AL">Alabama</option>
            <option value="AK">Alaska</option>
            <option value="AZ">Arizona</option>
            <option value="AR">Arkansas</option>
            <option value="CA">California</option>
            <option value="CO">Colorado</option>
            <option value="CT">Connecticut</option>
            <option value="DE">Delaware</option>
            <option value="FL">Florida</option>
            <option value="GA">Georgia</option>
            <option value="HI">Hawaii</option>
            <option value="ID">Idaho</option>
            <option value="IL">Illinois</option>
            <option value="IN">Indiana</option>
            <option value="IA">Iowa</option>
            <option value="KS">Kansas</option>
            <option value="KY">Kentucky</option>
            <option value="LA">Louisiana</option>
            <option value="ME">Maine</option>
            <option value="MD">Maryland</option>
            <option value="MA">Massachusetts</option>
            <option value="MI">Michigan</option>
            <option value="MN">Minnesota</option>
            <option value="MS">Mississippi</option>
            <option value="MO">Missouri</option>
            <option value="MT">Montana</option>
            <option value="NE">Nebraska</option>
            <option value="NV">Nevada</option>
            <option value="NH">New Hampshire</option>
            <option value="NJ">New Jersey</option>
            <option value="NM">New Mexico</option>
            <option value="NY">New York</option>
            <option value="NC">North Carolina</option>
            <option value="ND">North Dakota</option>
            <option value="OH">Ohio</option>
            <option value="OK">Oklahoma</option>
            <option value="OR">Oregon</option>
            <option value="PA">Pennsylvania</option>
            <option value="RI">Rhode Island</option>
            <option value="SC">South Carolina</option>
            <option value="SD">South Dakota</option>
            <option value="TN">Tennessee</option>
            <option value="TX">Texas</option>
            <option value="UT">Utah</option>
            <option value="VT">Vermont</option>
            <option value="VA">Virginia</option>
            <option value="WA">Washington</option>
            <option value="WV">West Virginia</option>
            <option value="WI">Wisconsin</option>
            <option value="WY">Wyoming</option>
          </select>
          <div
            class="alert alert-danger"
            id="stateError"
            style="display: none"
          ></div>
        </div>

        <!-- Education Section -->
        <h6 class="pt-4">Education</h6>

        <div class="form-group">
          <label for="tenth">10th Grade üéì</label>
          <input
            type="text"
            id="tenth"
            class="form-control"
            placeholder="Ex: 90%"
            required
          />
        </div>

        <div class="form-group">
          <label for="twelfth">12th Grade üéì</label>
          <input
            type="text"
            id="twelfth"
            class="form-control"
            placeholder="Ex: 90%"
            required
          />
        </div>

        <div class="form-group">
          <label for="graduation">Graduation with Percentage/Grade üéì</label>
          <input
            type="text"
            id="graduation"
            class="form-control"
            placeholder="Ex: 9.2 CGPA"
            required
          />
        </div>

        <div class="form-group">
          <label for="postGraduation"
            >Post Graduation with Percentage/Grade üéì</label
          >
          <input
            type="text"
            id="postGraduation"
            class="form-control"
            placeholder="Mtech with 9.2"
          />
        </div>

        <div class="form-group">
          <label for="phd">PhD with Percentage/Grade üéì</label>
          <input
            type="text"
            id="phd"
            class="form-control"
            placeholder="PhD with Grade"
          />
        </div>

        <!-- Resume Upload -->
        <div class="form-group">
          <label for="resume">Upload Resume üìÑ</label>
          <div class="custom-file">
            <input
              type="file"
              id="resume"
              class="custom-file-input"
              accept=".pdf, .doc, .docx"
              required
            />
            <label class="custom-file-label" for="resume">Choose file</label>
            <div
              class="alert alert-danger"
              id="resumeError"
              style="display: none"
            ></div>
          </div>
        </div>

        <!-- Update Resume Button -->
        <button
          type="submit"
          class="button-contactForm"
          onclick="validateForm()"
        >
          Create Resume
        </button>
      </div>
    </section>

    <script>
      // Fetch session or local storage data and populate the fields
      window.onload = function () {
        const username =
          localStorage.getItem("username") ||
          sessionStorage.getItem("username");
        const email =
          localStorage.getItem("email") || sessionStorage.getItem("email");
        const country =
          localStorage.getItem("country") || sessionStorage.getItem("country");

        if (username) {
          document.getElementById("username").value = username;
        }
        if (email) {
          document.getElementById("email").value = email;
        }
        if (country) {
          document.getElementById("country").value = country; // Set the country dropdown
        }
      };

      // Update the custom file label when a file is chosen
      document
        .querySelector(".custom-file-input")
        .addEventListener("change", function () {
          const fileName = this.files[0] ? this.files[0].name : "Choose file";
          const nextSibling = this.nextElementSibling;
          nextSibling.innerText = fileName;
        });

      function validateForm() {
        // Reset error messages
        // event.preventDefault();
        document.getElementById("nameError").style.display = "none";
        document.getElementById("mobileError").style.display = "none";
        document.getElementById("countryError").style.display = "none";
        document.getElementById("resumeError").style.display = "none";

        // Collect form data
        const fullName = document.getElementById("fullName").value;
        const username = document.getElementById("username").value;
        const address = document.getElementById("address").value;
        const mobile = document.getElementById("mobile").value;
        const email = document.getElementById("email").value;
        const race = document.getElementById("race").value;
        const country = document.getElementById("country").value;
        const ethnicity = document.getElementById("ethnicity").value;
        const state = document.getElementById("state").value;
        const sex = document.getElementById("sex").value;
        const resume = document.getElementById("resume").files[0];

        let valid = true;

        // Validate Name
        if (!/^[a-zA-Z\s]+$/.test(fullName)) {
          document.getElementById("nameError").innerText =
            "Name must be alphabetical.";
          document.getElementById("nameError").style.display = "block";
          valid = false;
        }

        // Validate Mobile Number
        if (!/^[6-9]\d{9}$/.test(mobile)) {
          document.getElementById("mobileError").innerText =
            "Mobile No must be 10 digits and start with 6-9.";
          document.getElementById("mobileError").style.display = "block";
          valid = false;
        }

        // Validate Country
        if (country === "") {
          document.getElementById("countryError").innerText =
            "Country is required.";
          document.getElementById("countryError").style.display = "block";
          valid = false;
        }

        if (race === "") {
          document.getElementById("raceError").innerText = "Race is required.";
          document.getElementById("raceError").style.display = "block";
          valid = false;
        } else {
          document.getElementById("raceError").style.display = "none";
        }

        if (ethnicity === "") {
          document.getElementById("ethnicityError").innerText =
            "Ethnicity is required.";
          document.getElementById("ethnicityError").style.display = "block";
          valid = false;
        } else {
          document.getElementById("ethnicityError").style.display = "none";
        }
        if (state === "") {
          document.getElementById("stateError").innerText =
            "State is required.";
          document.getElementById("stateError").style.display = "block";
          valid = false;
        } else {
          document.getElementById("stateError").style.display = "none";
        }
        // Validate Resume Upload
        if (!resume) {
          document.getElementById("resumeError").innerText =
            "Resume is required.";
          document.getElementById("resumeError").style.display = "block";
          valid = false;
        }

        // If all validations pass, send data to the API
        if (valid) {
          // Create FormData to handle file upload
          const formData = new FormData();
          formData.append("fullName", fullName);
          formData.append("username", username);
          formData.append("address", address);
          formData.append("mobile", mobile);
          formData.append("email", email);
          formData.append("country", country);
          formData.append("resume", resume);

          // Send the data to the API
          fetch(
            "https://monkfish-app-vqwar.ondigitalocean.app/api/jobs/profile",
            {
              method: "POST",
              body: formData,
            }
          )
            .then((response) =>
              response
                .json()
                .then((data) => ({ status: response.status, data }))
            ) // Include status code in response
            .then((res) => {
              if (res.status === 201) {
                // Check for 201 status code (created)
                document.getElementById("msgBox").innerHTML =
                  '<div class="alert alert-success">Resume updated successfully!</div>';
                window.location.href = "profile.html";
              } else {
                document.getElementById("msgBox").innerHTML =
                  '<div class="alert alert-danger">Failed to update resume. Please try again later.</div>';
              }
            })
            .catch((error) => {
              document.getElementById("msgBox").innerHTML =
                '<div class="alert alert-danger">Error: ' +
                error.message +
                "</div>";
            });
        }
      }
    </script>
  </body>
</html>
